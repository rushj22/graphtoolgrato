<!doctype html>
<html>
<head>
    <title>Grato</title>
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>

    <script type="text/javascript">
    var graph_type,graph_weighttype,graph_edge,graph_vertex,graph_vertex1,graph_vertex2,graph_weight;
    var edge_count=0,index=1;
    var myGraph=[{vertex1:"",vertex2:"",weight:""}];
    var myGraph_undir=[{vertex1:"",vertex2:"",weight:""}];
    var myGraph_mst=[{vertex1:"",vertex2:"",weight:""}];
 
    var par=[];
    var rank=[];

    function weightvisible()
    {
      document.getElementById("g_weight").style.display = 'none';
    }
    function g_button_type(clicked_id_graphtype)
    {
    
      if (check_graph_type(clicked_id_graphtype)==1)
      {
        graph_type="directed";
        document.getElementById("g_print_type").innerHTML=graph_type;
      }
      else if (check_graph_type(clicked_id_graphtype)==0)
      {
        graph_type="undirected";
        document.getElementById("g_print_type").innerHTML=graph_type;
      }
      else
        document.getElementById("g_print_type").innerHTML="Invalid, Enter again\n"; 
    }
    function check_graph_type(clicked_id_graphtype)
    {
      if (clicked_id_graphtype.localeCompare("button_directed")==0)
        return 1;
      else if (clicked_id_graphtype.localeCompare("button_undirected")==0)
        return 0;
    }
  
    function g_button_weighttype(clicked_id_weighttype)
    {   
      if(check_graph_weighttype(clicked_id_weighttype)==1)
      {
        graph_weighttype="weighted";
        document.getElementById("g_weight").style.display = 'inline';
        document.getElementById("g_print_weighttype").innerHTML=graph_weighttype;
      }
      else if(check_graph_weighttype(clicked_id_weighttype)==0)
      {
        graph_weighttype="unweighted";
        document.getElementById("g_print_weighttype").innerHTML=graph_weighttype;
      }
      else
        document.getElementById("g_print_weighttype").innerHTML="Invalid, Enter again\n";
    }
    function check_graph_weighttype(clicked_id_weighttype)
    {
      if (clicked_id_weighttype.localeCompare("button_weighted")==0)
        return 1;
      else if (clicked_id_weighttype.localeCompare("button_unweighted")==0)
        return 0;
    }
    function g_button_edgevertex()
    { 
      graph_edge=document.getElementById("g_edge").value;
      graph_vertex=document.getElementById("g_vertex").value;
      document.getElementById("g_print_edgevertex").innerHTML="edges: "+graph_edge+" vertices: "+graph_vertex;
    }
    function g_button_edgenodes()
    {
      graph_vertex1=document.getElementById("g_vertex1").value;
      graph_vertex2=document.getElementById("g_vertex2").value;
      if (graph_weighttype.localeCompare("weighted")==0)
        graph_weight=document.getElementById("g_weight").value;
      else
        graph_weight=1;
      storeprint_graph()  
    }

    function storeprint_graph()
    { 
      edge_count++;

      if (edge_count>graph_edge)
      {
        var newEdge=document.createElement('p');
        newEdge.textContent="You have already entered number of edges mentioned";
        document.getElementById("print_newedge").appendChild(newEdge);
      }
      else
      {
        var newobj={vertex1:graph_vertex1,vertex2:graph_vertex2,weight:graph_weight};
        myGraph.push(newobj);

        if(graph_weighttype.localeCompare("weighted")==0)
        {
          var new_edge="Added edge: "+edge_count+" !\n";
          document.getElementById("print_newedge").innerHTML=new_edge;
        }       
        else if(graph_weighttype.localeCompare("unweighted")==0)
        {
          var new_edge="Added edge: "+edge_count+" !\n";
          document.getElementById("print_newedge").innerHTML=new_edge;
        }
      
        if(graph_type.localeCompare("undirected")==0)
        {
          myGraph_undir.push(newobj);
          var newobj={vertex1:graph_vertex2,vertex2:graph_vertex1,weight:graph_weight};
          myGraph_undir.push(newobj);
        }
      }
    }

    function find(vertex)
    {
      if(vertex!=par[vertex])
        return find(par[vertex]);
      return par[vertex];
    }
    function union(v1,v2)
    {
      var x1=find(v1);
      var x2=find(v2);

      if (rank[x1]<rank[x2])
        par[x1]=x2;
      else if (rank[x2]<rank[x1])
        par[x2]=x1;
      else
      {
        par[x2]=x1;
        rank[x1]++;
      }
    }   
    function kruskal()
    {
      var i;
      var newEdge=document.createElement('p');
      newEdge.textContent="Kruskal Output\n";
      document.getElementById("kruskal_mstedge").appendChild(newEdge);

      for (i=1;i<=graph_edge;i++)
      {
        par[i]=i;
        rank[i]=0;
      }
      myGraph.sort(function(a, b)
      {
        return a.weight-b.weight;
      })

      var ptr=1;
      var count=0;
      var time=0;
      while(count!=graph_vertex-1)
      {
        var v1=myGraph[ptr].vertex1;
        var v2=myGraph[ptr].vertex2;
        var x1=find(v1);
        var x2=find(v2);
        if(x1!=x2)
        {
          myGraph_mst.push(myGraph[ptr]);
          count++;
          union(myGraph[ptr].vertex1,myGraph[ptr].vertex2);

        /*var newEdge=document.createElement('p');
          newEdge.textContent=myGraph[ptr].vertex1+" "+myGraph[ptr].vertex2+"\n";
          document.getElementById("kruskal_mstedge").appendChild(newEdge);
        */
          var label_name;
          label_name="label"+myGraph[ptr].vertex1+""+myGraph[ptr].vertex2;
          d3.select("svg").append("line").attr("id",label_name).attr("x1",myCoordinates[myGraph[ptr].vertex1].x1).attr("y1",myCoordinates[myGraph[ptr].vertex1].y1).attr("x2",myCoordinates[myGraph[ptr].vertex2].x1).attr("y2",myCoordinates[myGraph[ptr].vertex2].y1).style("stroke-width",2).style("stroke","green").transition().duration(1000).delay(time*2000).style("stroke","yellow");

          time++;
         }
        ptr++;
      }
    }

    var x,y;
    var myCoordinates=[{x1:"",y1:""}];
    function g_button_drawgraph()
    { 
      for(var i = 0; i < graph_vertex; i++) 
      {
        x = 800+200 * Math.cos(2 * Math.PI * i / graph_vertex);
        y = 300+200 * Math.sin(2 * Math.PI * i / graph_vertex);

        var newobj={x1:x,y1:y};
        myCoordinates.push(newobj);
      }
      for(i=0;i<graph_vertex;i++)
      {
        d3.select("svg").append("circle").attr("cx", myCoordinates[i+1].x1).attr("cy", myCoordinates[i+1].y1).attr("r", 20).attr("stroke","black").attr("stroke-width",3).style("fill", "yellow");
        
        d3.select("svg").append("text").attr("x",myCoordinates[i+1].x1-5).attr("y",myCoordinates[i+1].y1+5).text(i+1).attr("font-family", "sans-serif").attr("font-size", "20px").attr("fill", "red");
      }
      for(i=1;i<=graph_edge;i++)
      {
        var label_name;
        label_name="label"+myGraph[i].vertex1+""+myGraph[i].vertex2;
        
        d3.select("svg").append("line").attr("id",label_name).attr("x1",myCoordinates[myGraph[i].vertex1].x1).attr("y1",myCoordinates[myGraph[i].vertex1].y1).attr("x2",myCoordinates[myGraph[i].vertex2].x1).attr("y2",myCoordinates[myGraph[i].vertex2].y1).style("stroke","green").style("stroke-width",2);
      }

      if(graph_weighttype.localeCompare("weighted")==0)
      {
        for(i=1;i<=graph_edge;i++)
        {
          d3.select("svg").append("text").attr("x",(myCoordinates[myGraph[i].vertex1].x1+(2*myCoordinates[myGraph[i].vertex2].x1))/3).attr("y",(myCoordinates[myGraph[i].vertex1].y1+(2*myCoordinates[myGraph[i].vertex2].y1))/3).text(myGraph[i].weight).attr("font-family", "sans-serif").attr("font-size", "15px").attr("fill", "red");
        }
      }   
    }
    </script>

</head>

<svg width="5000" height="5000">
    <foreignObject x="50" y="0" width="500" height="700">
      <body onload= weightvisible();>

        <h3>Enter type of Graph (directed / undirected) </h3>
        <button type="button" id="button_directed" onclick="g_button_type(this.id)" >Directed</button>
        <button type="button" id="button_undirected" onclick="g_button_type(this.id)" >Undirected</button><br />

        <h3>Enter type of Graph (weighted / unweighted) </h3>
        <button type="button" id="button_weighted" onclick="g_button_weighttype(this.id)" >Weighted</button>
        <button type="button" id="button_unweighted" onclick="g_button_weighttype(this.id)" >Unweighted</button><br />

        <h3>Enter the number of edges and vertices </h3>
        <input type="text" style="width:75px" id="g_edge">
        <input type="text" style="width:75px" id="g_vertex" />
        <button type="button" id="button_edgevertex" onclick="g_button_edgevertex()" >Enter</button><br />

        <h3>Enter the edge nodes (and weight)</h3>
        <input type="text" style="width:75px" id="g_vertex1" />
        <input type="text" style="width:75px" id="g_vertex2" />
        <input type="text" style="width:75px" id="g_weight" />
        <button type="button" id="button_edgenodes" onclick="g_button_edgenodes()" >Enter</button><br />
        <br>
        <button type="button" id="button_drawgraph" onclick="g_button_drawgraph()" >Draw Graph</button><br />
        
        <h3>Function</h3>
        <button type="button" id="button_kruskal" onclick="kruskal()" >Kruskal</button><br />

        <p id="g_print_type"></p>
        <p id="g_print_weighttype"></p>
        <p id="g_print_edgevertex"></p>
        <p id="print_newedge"></p>
        <p id="kruskal_mstedge"></p>

      </body>
    </foreignObject>
</svg>
</html>